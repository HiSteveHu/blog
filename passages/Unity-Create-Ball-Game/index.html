<!DOCTYPE html>
<html>
  
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  <meta name="author" content="Dong Yuanxin">
  
  
  <title>Unity:制作小球滚动游戏 | HiSteveHu</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="Unity,教程,">
  

  
  <meta name="description" content="这里我们将以制作一个小球滚动的游戏为例，以快速熟悉Unity的常用界面操作概念、入门Unity。">

  

  
    <script src="//cdn.jsdelivr.net/npm/leancloud-storage@3.11.1/dist/av-min.js" async></script>
  

  
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script>
  

  
    <script src="//unpkg.com/valine/dist/Valine.min.js" async></script>
  

  

  <script>
  // theme-ad's config script
  // it can be used in every script
  
  window.AD_CONFIG = {
    leancloud: {"appid":"Hyq9wkH495DgNHWhDQCOfQSp-gzGzoHsz","appkey":"WaR7nrzhliHj9aVwdQzkdlGd","comment":true,"count":true},
    welcome: {"enable":false,"interval":30},
    start_time: "2018-02-10",
    passwords: ["efe07af7441da2b69c4a41e42e73be4db47f66010a56900788a458354a7373ec", ],
    is_post: true,
    lock: false,
    author: "Dong Yuanxin",
    share: {"twitter":true,"facebook":true,"weibo":true,"qq":true,"wechat":true},
    mathjax: true,
    page_type: "",
    root: "/"
  };
</script>

  <script src="/vendor/sha256.min.js"></script>
<script src="/js/auth.js"></script>
<script src="/js/index.js"></script>
<script src="/vendor/qrcode.min.js"></script>

  
    <link rel="icon" href="/images/favicon.ico">
    <link rel="apple-touch-icon" href="/images/touch-icon.png">
  

  <link href="//netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel="stylesheet" href="/css/index.css">
<link rel="stylesheet" href="/styles/components/highlight/highlight.css">

  
</head>
  <body>
    <header class="site-header">
  <div class="site-header-brand">
    
      <span class="site-header-brand-title">
        <a href="/">GODBMW</a>
      </span>
    
    
      <span class="site-header-brand-motto"> | 安静写些东西</span>
    
  </div>
  <div class="site-header-right">
    <nav class="site-header-navigation">
      
        <a href="/" target="_self">首页</a>
      
        <a href="/archives/" target="_self">归档</a>
      
        <a href="/tags/" target="_self">标签</a>
      
        <a href="/categories/" target="_self">分类</a>
      
        <a href="/friends/" target="_self">友链</a>
      
        <a href="/about/" target="_self">关于</a>
      
    </nav>
    <div class="site-header-btn">
      
        <a href="https://github.com/dongyuanxin/" target="_blank" id="site-github">
          <i class="fa fa-github-alt"></i>
        </a>
      
      <a href="javascript:void(0);" id="site-search">
        <i class="fa fa-search"></i>
      </a>
      <a href="javascript:void(0);" id="site-nav-btn">
        <i class="fa fa-ellipsis-v"></i>
      </a>
    </div>
  </div>
</header>
<nav class="table-content" id="site-nav">
  <div class="table-content-title">
    <span>导航</span>
  </div>
  <div class="table-content-main">
    <ol class="toc">
      
        <li class="toc-item">
          <a href="/" target="_self">
            首页
          </a>
        </li>
      
        <li class="toc-item">
          <a href="/archives/" target="_self">
            归档
          </a>
        </li>
      
        <li class="toc-item">
          <a href="/tags/" target="_self">
            标签
          </a>
        </li>
      
        <li class="toc-item">
          <a href="/categories/" target="_self">
            分类
          </a>
        </li>
      
        <li class="toc-item">
          <a href="/friends/" target="_self">
            友链
          </a>
        </li>
      
        <li class="toc-item">
          <a href="/about/" target="_self">
            关于
          </a>
        </li>
      
    </ol>
  </div>
</nav>
<div id="site-process"></div>
    <main>
      
  <div class="passage">
  <div class="passage-meta">
    <span>
      <i class="fa fa-calendar"></i>2020-02-02
    </span>
    
      <span>
        | <a href="/categories/Unity/"><i class="fa fa-bookmark"></i>Unity</a>
      </span>
    
    
      <span>
        | <i class="fa fa-unlock-alt"></i>UNLOCK
      </span>
    
  </div>
  <h1 class="passage-title">
    Unity:制作小球滚动游戏
  </h1>
  
  <article class="passage-article">
    <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a><strong>前言</strong></h3><hr>
<p>游戏构思很简单，在一个平面内，通过键盘操作小球滚动击中上面的立方体以获得分数并显示在左上角。当玩家击中全部的立方体之后，跳转到另一个界面提示游戏完成，玩家胜利，并附有重新开始游戏的按钮。</p>
<p><img src="0.jpg" style="zoom:30%;"></p>
<p><img src="1.jpg" style="zoom:30%;"></p>
<p>通过这个学习，你将会主要掌握：</p>
<ul>
<li>Unity中一些基本知识</li>
<li>常用组件的控制（移动、旋转、设定颜色及材质）</li>
<li>摄像机的简单跟踪</li>
<li>简单碰撞判断原理</li>
</ul>
<p><strong>注意：</strong></p>
<ul>
<li><strong>本文需要基本C#语言基础，如果你没有学习过这门语言可以事先学习一下再开始这个教程。别担心，很简单</strong></li>
<li>本文基于Unity 2019.3.0f6 ，外部代码编辑器为 Visual Studio 2019</li>
</ul>
<p>让我们开始吧！</p>
<h3 id="Unity中的一些基本知识"><a href="#Unity中的一些基本知识" class="headerlink" title="Unity中的一些基本知识"></a><strong>Unity中的一些基本知识</strong></h3><hr>
<h4 id="概念"><a href="#概念" class="headerlink" title="概念"></a><strong>概念</strong></h4><ul>
<li><p><strong>Game Object    游戏对象</strong>    </p>
<p>Game Object是搭建游戏的最基础的模块，但是任何一个Game Object本身并没有任何作用，其属性以及行为都由这个Game Object所拥有的Components决定</p>
</li>
<li><p><strong>Components   元件</strong></p>
<p>Components从属于Game Object，从而定义了每一个Game Object应该表现哪些行为以及拥有哪些属性</p>
</li>
<li><p><strong>Prefabs   预设体</strong></p>
<p>有些Game Object我们以后可能会经常用到（比如游戏中的墙），如果我们为其设置好了很多Components以及其对应的值，后期需要更改属性的时候，我们肯定不希望每一面墙都重新添加一遍这些Components或重新设置参数值，那么此时我们就可以将一些Game Objects保存成为Prefabs，下次用到可以拿来即用，因为Prefabs可以生成很多的同样的Game Object</p>
<p>Prefabs之于Game Object相当于编程中的类之于对象</p>
<p>因而当我们需要生成一个Game Object时，只需要将Project窗口中的相应Prefab拖动到Hierarchy窗口即可完成实例化，生成一个Game Object。（界面视图介绍详见后文）</p>
</li>
<li><p><strong>Assets   资产</strong></p>
<p>Assects可以是3D models（3D模型）、audio files（音频文件）、scripts（脚本）等等。（显然，Prefabs也是一种assets）这些资产可以看成是游戏的原材料，构成了我们的游戏</p>
</li>
</ul>
<h4 id="界面"><a href="#界面" class="headerlink" title="界面"></a><strong>界面</strong></h4><p><img src="3.jpg" alt=""></p>
<p><strong>①Hierarchy    层次管理器</strong></p>
<p>管理各个Game Object的层次结构</p>
<p><strong>②Project    工程管理器</strong></p>
<p>管理当前工程的Assets</p>
<p><strong>③Scene    场景视图</strong></p>
<p>通过Scene视图对整个游戏的所有Game Object（如地图、道具、角色等）进行一些操作，比如拖动任何一个可动的元素，调整其位置角度大小；改变观看这个世界的角度、远近等。称这个模式为Edit模式。</p>
<p><strong>④Game    游戏视图</strong></p>
<p>Game窗口所展示的内容即玩家看到的内容，因而尽管我们可以在Scene窗口中随意变化观察的角度，但是Game窗口的内容却只取决于Camera所看到的内容。<br>同时如果运行游戏的话还可以在Game窗口中直接“玩”我们的游戏，从而达到调试的目的。</p>
<p><strong>⑤Inspector    属性</strong></p>
<p>列出了所选中的Game Object的所有Components，这里可以对它们进行管理并且更改参数值</p>
<p><strong>⑥Console    终端</strong></p>
<p>控制台所打印的信息，可以用来调试C#脚本或者其他内容</p>
<p><strong>你的视图可能与截图有所不同，这里仅仅以我们所常用的视图结构为例</strong></p>
<h3 id="正式开始"><a href="#正式开始" class="headerlink" title="正式开始"></a><strong>正式开始</strong></h3><hr>
<p>前面我们已经简单介绍了Unity的一些基本概念，这里我们将正式开始游戏的制作</p>
<p>打开Unity，新建一个3D工程。我们会看到Unity已经事先为我们新建了两个Game Object: Main Camera和Directional Light，保留它们，后文将会用到</p>
<p>然后在Project窗口，新建以下文件夹为后续工作准备：Materials, Prefabs, Scenes, Scripts</p>
<p>至此，你的层次结构和工程资产应该如下：</p>
<p><img src="4.jpg" style="zoom:50%;"></p>
<p><img src="5.jpg" style="zoom:50%;"></p>
<h3 id="添加-amp-设置游戏对象"><a href="#添加-amp-设置游戏对象" class="headerlink" title="添加&amp;设置游戏对象"></a><strong>添加&amp;设置游戏对象</strong></h3><hr>
<h4 id="地面"><a href="#地面" class="headerlink" title="地面"></a><strong>地面</strong></h4><p>Hierarchy窗口，右键，3D Object，Plane</p>
<p><img src="6.jpg" style="zoom:50%;"></p>
<p>然后在Inspector窗口将Plane重命名为Ground，在Transform选项卡中，点选项卡的右上角省略号，Reset，重置平面的位置及大小</p>
<p><img src="7.jpg" style="zoom:50%;"></p>
<p>接下来，我们要为地面添加材质颜色</p>
<p>在Project窗口中，进入Materials文件夹，右键，Create，Material，这时会生成一个材质球并等待命名，我们将它命名为background。然后在Inspector中将Albedo（反射率）设成自己喜欢的颜色（这里以RGB（0,32,64）为例），然后将材质球拖动到Scene窗口的Ground对象上以将材质球应用。</p>
<p><img src="8.jpg" alt=""></p>
<h4 id="球"><a href="#球" class="headerlink" title="球"></a><strong>球</strong></h4><p>Hierarchy窗口，右键，3D Object，Sphere</p>
<p>然后在Inspector窗口将Sphere重命名为Player，在Transform选项卡中，点选项卡的右上角省略号，Reset，重置平面的位置及大小，然后将Position属性的Y设置为0.5</p>
<p>因为小球会遇到碰撞等事件，为了模拟物理属性，我们需要为其添加相应的Components。在Inspector窗口，点击最底部的Add Component，输入Rigidbody以添加</p>
<h4 id="墙"><a href="#墙" class="headerlink" title="墙"></a><strong>墙</strong></h4><p>正如最终游戏截图所示，我们计划在平面四周各建立墙体以防止玩家的小球脱离平面坠落。当然你也可以跳过这一步，如果你想让游戏更惊险刺激。但在这里我们将会使用Prefab进行建造，后文也将用到这一重要概念，因此我们强烈建议你不要跳过</p>
<p>Hierarchy窗口，右键，3D Object，Create Empty，创建一个空的Game Object，用以当作墙体集合，重命名为Walls，然后在Walls对象上右键，3D Object，Cube，在Inspector窗口调整大小以符合地面边长并重命名为wall，这样wall就成为了Walls的子对象</p>
<p>然后将wall拖动到Project窗口的Prefabs文件夹，将会自动创建wall对象的prefab，同时wall对象会变成蓝色，证明创建成功</p>
<p><img src="9.jpg" style="zoom:50%;"></p>
<p>Ctrl+D快速复制出剩余三个墙体并移动摆放好位置</p>
<h4 id="立方体"><a href="#立方体" class="headerlink" title="立方体"></a><strong>立方体</strong></h4><p>立方体与墙体构造方法类似。先创建一个空对象，命名为Cubes作为集合。然后在其中新建Cube，命名为cube，拖动到Project窗口的Prefab文件夹以生成预设体。然后Ctrl+D快速复制若干个立方体并摆好位置</p>
<p>为了美观，我们可以为立方体们设置材质颜色。在Materials文件夹内新建材质命名为cube，设置Albedo为你喜欢的颜色（这里随机以黄色为例）。因为我们使用预制体构建，所以上色十分方便。只要在Project窗口中选中cube预制体，双击进入编辑模式，将材质球拖动到预制体上即可。</p>
<p>如游戏设计思路所言，我们需要控制小球击中立方体以获得分数，因此我们也要像小球一样，为立方体设置刚体的物理属性。在Inspector窗口，点击最底部的Add Component，输入Rigidbody，为cube预制体添加刚体属性</p>
<p>然后点击Scene导航条的Scenes场景退出编辑模式，然后我们会发现所有立方体已经成功添加了材质球和刚体属性</p>
<p><img src="10.jpg" style="zoom:50%;"></p>
<p>到这里，我们已经完成了游戏所需要的所有Game Object的添加和设置工作。</p>
<h3 id="代码，魔法"><a href="#代码，魔法" class="headerlink" title="代码，魔法"></a><strong>代码，魔法</strong></h3><hr>
<p>试着运行一下游戏，很好，所有的对象都出现在Game窗口里，但无法使用键盘控制小球移动。接下来我们需要添加一些代码来实现这个目标。</p>
<h4 id="球的移动"><a href="#球的移动" class="headerlink" title="球的移动"></a><strong>球的移动</strong></h4><p>我们在Scripts文件夹下来管理代码，在该目录处右键，Create，C# Script创建一个脚本并命名为PlayerController。然后我们需要将这个脚本与小球Player关联起来。选择Player，在Inspector面板下选择Add Component，在其中搜索我们的脚本名字就可以找到该脚本完成绑定。</p>
<p>双击脚本文件，自动调用外部编辑器打开（推荐使用Visual Studio，这里以2019版本为例）</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerController</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Start is called before the first frame update</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update is called once per frame</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Unity已经为我们预置好了脚本的结构，最基本的，我们可以看到所有的Unity脚本都继承自MonoBehaviour类，然后有两个预设函数，Start函数是在第一帧开始渲染前调用，Update函数在每一帧刷新前调用，都是非常常用的函数<br> 接下来思考我们要做的事情，我们需要检测用户的输入，并且通过输入的按键来控制小球的滚动方向，检测用户的输入同时也需要识别输入的是哪一个按键，除此之外我们还需要一些物理学有关的逻辑，比如我们需要添加一个力来控制小球的移动，这就是物理学逻辑，这些逻辑当然是每一帧都要进行一次，所以我们需要将这些逻辑写在每一帧更新都要执行的函数中<br>显然我们可以写到Update函数下，因为Update函数是每一帧刷新前都会调用的，同时我们还有另外的选择，即使用FixedUpdate函数，它在每一次进行物理学运算的时候调用，每次检测到用户输入都需要进行物理学运算，所以我们可以将逻辑写到FixedUpdate函数下</p>
<p>首先我们需要创建一个对于这个Player小球的引用，这样才能知道我们控制的是哪个小球，这里小球是刚体，所以我们创建一个刚体（Rigidbody）的引用，并且需要在第一帧开始渲染之前通过GetComponent方法来找到小球创建刚体的引用，这一逻辑自然就需要写到Start函数中了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">private Rigidbody rigidbodyPlayer;</span><br><span class="line"></span><br><span class="line">void Start()</span><br><span class="line">&#123;</span><br><span class="line">    rigidbodyPlayer = GetComponent&lt;Rigidbody&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接下来对用户输入的读取就需要写到FiexedUpdate函数中了，我们使用Input类的GetAxis方法来获取水平或者垂直的运动轴，这个方法会返回一个float值作为该轴的移动距离</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">float moveHorizontal = Input.GetAxis(&quot;Horizontal&quot;);</span><br><span class="line">float moveVertical = Input.GetAxis(&quot;Vertical&quot;);</span><br></pre></td></tr></table></figure>
<p>通过以上两行代码我们就可以将用户的W，S，A，D输入转化为水平轴和垂直轴的移动距离，分别存储在moveHorizontal和moveVertical两个float类型的变量中</p>
<p>接下来通过Rigidbody类的AddForce方法可以为刚体添加作用力，AddForce方法接受一个三维向量（Vector3）参数，这个三维向量就可以表示力，显然我们的三维向量可以用刚才的moveHorizontal和moveVertical两个变量作为X值和Z值，同时我们是不需要小球在Y方向上移动的，也就是将Y方向的力作用设置为0.0f即可，经过调试我们会发现小球的移动速度过慢，为了方便调节小球的速度，只需要在表示力的三维向量前乘以一个倍数即可，为了方便调整，我们设置一个public的float类型的变量speed来调节这个乘积<br><strong>另外，凡在Unity的脚本中被声明为public类型的变量，在Unity的Inspector界面中的该脚本的Component下都会出现一个可以设置的值的方框</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public float speed;</span><br><span class="line">void FixedUpdate()</span><br><span class="line">&#123;</span><br><span class="line">    Vector3 movement = new Vector3(moveHorizontal,0.0f,moveVertical);</span><br><span class="line">    rigidbodyPlayer.AddForce(movement*speed);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="12.jpg" style="zoom:50%;"></p>
<p>这里我们将speed的值设为10，运行游戏就会发现通过W，S，A，D的控制，小球动了起来</p>
<h4 id="摄像机的跟踪"><a href="#摄像机的跟踪" class="headerlink" title="摄像机的跟踪"></a><strong>摄像机的跟踪</strong></h4><p>可以发现，我们的Camera的角度和位置都比较刁钻，这导致我们的游戏看到的画面并不完整，接下来我们对Camera进行设置，使其能够跟随我们的小球滚动来同时移动</p>
<p>首先调节Main Camera的Position和Rotation使得画面和角度比较合适</p>
<p>接下来通过脚本控制Main Camera跟随小球Player一同移动，即在Position上保持相对静止</p>
<blockquote>
<p>可能你会想到，只需要将Main Camera拖动给Player使其成为Player的子物体不就可以保持两者相对位置不变化了吗？但是问题在于球体Player是滚动的，如果两者的位置完全相对静止，就会导致球滚动时Main Camera也会跟着球滚动，产生天旋地转的感觉。</p>
</blockquote>
<p>新建脚本CameraController并添加给Main Camera做一个Component。为了使Main Camera的Transform的Position和Player的保持相对静止，Rotation并不和其保持一致，可以想到一个办法：设置一个偏移量，这个值初始化为游戏开始时Main Camera和Player之间的Position的差值，然后在球滚动时，每一次滚动都改变Main Cmaera的Position，使其新的Position等于现在球的Position的值加上刚才的偏移量，这样就会在每次球的位置改变时Main Camera都会跟上它的步骤<br>显然，偏移量的设置需要在Start函数中完成，每一次球的位置发生变化时的逻辑可以在Update函数中完成，但还有一个更好的选择，就是LateUpdate函数，该函数在每次有GameObject发生变动时才会调用。同时，我们的脚本使加在Main Camera上的，所以Main Camera的Transform可以直接调用，但是球的Transform则需要单独获取，这里我们设置一个public的GameObject量，然后在Unity中将球Player拖动到这个量处作为参数即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">private Vector3 offset;</span><br><span class="line">public GameObject player;</span><br><span class="line"></span><br><span class="line">void Start()</span><br><span class="line">&#123;</span><br><span class="line">    offset = transform.position - player.transform.position;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void LateUpdate()</span><br><span class="line">&#123;</span><br><span class="line">    transform.position = player.transform.position + offset;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="13.jpg" style="zoom:50%;"></p>
<p>这时候运行游戏就可以发现Main Camera的位置随着球的改变而发生了改变</p>
<h4 id="立方体的旋转"><a href="#立方体的旋转" class="headerlink" title="立方体的旋转"></a><strong>立方体</strong>的旋转</h4><p>我们已经在地面上放置了若干个立方体，为了增强视觉效果可以让它们原地缓缓旋转。当然你也可以跳过这一小节。</p>
<p>新建脚本Rotator，并添加给预设体cube，编辑此脚本。这个逻辑中是不需要Start函数的，我们只需要每一帧都让小方块儿转动一下，所以将逻辑写到Update函数中，这里使用Ratate方法，需要一个Vector3作为参数。为了不让旋转过快，我们给每一帧都乘以一个小的时间量</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Vector3 rotation = <span class="keyword">new</span> Vector3(<span class="number">15</span>,<span class="number">30</span>,<span class="number">45</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Update</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    transform.Rotate(rotation * Time.deltaTime);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>保存脚本，运行游戏可以看到小方块旋转起来了。</p>
<h4 id="碰撞"><a href="#碰撞" class="headerlink" title="碰撞"></a><strong>碰撞</strong></h4><p>如果小球碰撞了旋转的立方体，那么立方体就会消失。那么如何识别我们的小球Player碰撞的是立方体呢？我们通过为预设体cube添加特定的标签来识别。在Assets的Prefabs中找到我们的cube并打开它，可以在它的Inspector面板中发现它还没有添加标签（Untagged），点击Tag后的按钮选择Add Tag…，来添加一个名为cube的标签，然后再回到最开始的面板处选择新添加的这个标签，这样cube的标签就添加好了。</p>
<p><img src="14.Jpg" style="zoom:50%;"></p>
<p>重新打开PlayerController脚本，这里我们将碰撞发生的逻辑写到函数OnTriggerEnter中，这个函数在发生碰撞事件的时候调用，而且用碰到的Collider（碰撞机）作为参数，也就是我们的Player碰到的Collider。可见，如果要检测到的碰撞，被碰撞的物体需要由碰撞引擎，也就是要有Collider的属性，其实我们会发现，作为cube保存的一个Prefab在创建之初就已经有Box Collider的这一Component了，所以不再需要我们自己添加。</p>
<p><strong>但是我们需要勾选上Is Trigger选项</strong></p>
<blockquote>
<p>这里的原因需要我们了解一定的Unity碰撞原理。Unity将Collider（碰撞机）分为静态碰撞机（Static Collider）和动态碰撞机（Dynamic Collider）两种。</p>
<p>静态的碰撞机比如墙面、地板等一些列静态的物体，与他们碰撞时，不允许两个Collider相互重合，也就是说会发生反弹。</p>
<p>而为了让我们的碰撞能够实现（碰撞后立方体消失），我们需要将立方体设置为动态的（Trigger）触发器，成为Trigger的Collider是可以被穿过的，这样才会引发我们的“碰撞事件”的逻辑。这里我们找到预设体cube，在它的Box Collider的Component中，勾选Is Trigger选项，这样它就成为了一个动态触发器。</p>
</blockquote>
<p><img src="15.jpg" style="zoom:50%;"></p>
<p>OnTriggerEnter函数用其碰撞到的Collider作为参数，现在就需要我们识别这个碰到的Collider是不是一个cube立方体了，显然可以使用Tag来鉴别。这里使用gameObject的CompareTag方法来完成。该方法以一个字符串作为参数，返回一个布尔值，如果gameObject的Tag和字符串一致，就返回true。<br>接下来完成控制小立方体消失的逻辑，使用gameObject的方法SetActive来完成。这个方法接受一个布尔值作为参数来控制GameObject的消失与显现。作用同我们在Inspector面板中看到的每一个GameObject前的小对勾相同。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">void OnTriggerEnter(Collider other)</span><br><span class="line">&#123;</span><br><span class="line">    if (other.gameObject.CompareTag(&quot;cube&quot;))</span><br><span class="line">    &#123;</span><br><span class="line">        other.gameObject.SetActive(false);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="计数器"><a href="#计数器" class="headerlink" title="计数器"></a><strong>计数器</strong></h4><p>接下来添加一个计数器，每撞到一个小球就使计数器数值增加1。自然需要编辑PlayerController脚本，声明一个int类型的变量，在Start函数中初始化为0，在每一次碰撞到小立方体后都增加一。这里特地将count每次更新后的值都打印到控制台来验证其正确性。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">private int count;</span><br><span class="line">void Start()</span><br><span class="line">&#123;</span><br><span class="line">    rigidbodyPlayer = GetComponent&lt;Rigidbody&gt;();</span><br><span class="line">    count = 0;</span><br><span class="line">&#125;</span><br><span class="line">void OnTriggerEnter(Collider other)</span><br><span class="line">&#123;</span><br><span class="line">    if (other.gameObject.CompareTag(&quot;cube&quot;))</span><br><span class="line">    &#123;</span><br><span class="line">        other.gameObject.SetActive(false);</span><br><span class="line">        count++;</span><br><span class="line">        Debug.Log(count);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="16.jpg" style="zoom:50%;"></p>
<p>但显然，将分数显示在游戏界面中才是更好的选择，这里需要用到UI组件。<br>在Hierarchy窗口中，右键，UI，Text，就会创建一个UI组件，但是我们会发现其实Text外还有一层Canvas（画布），下方还出现了一个EventSystem，这些都是Unity为我们自动创建的，这是因为：</p>
<blockquote>
<p>The single most important thing to know about these additional items is that all UI elements must be the child of a canvas to behave correctly.<br> （所有的UI元素都必须是一个Canvas（画布）的子元素才能正常工作）</p>
</blockquote>
<p>这里将Text命名为CountText。接下来我们来调整它的位置。</p>
<p>找到Inspecctor的Rect Transform，可以看到UI的Transform和一般GameObject的定位方式不同，这个位置的确定是相对于游戏屏幕的，点击左边的这个方框，展开位置选择的面板，根据提示：按住Shift键选择中心轴（pivot），按住Alt键选择位置（position）。我们选择同时按住Shift和Alt键，将Text放到Canvas的左上角：</p>
<p><img src="17.jpg" style="zoom:50%;"></p>
<p>这样就可以看到Count Text放置到了Game窗口的左上角。接下来可以改变Rect Transform的Pos X的值和Pos Y的值让Count Text稍微离左边缘和顶部边缘一段距离</p>
<p>接下来要将分数显示到Text中，继续编辑PlayerController脚本，首先需要添加新的Namespace：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">using UnityEngine.UI;</span><br></pre></td></tr></table></figure>
<p>然后自然需要创建一个Text变量来表示CountText的一个引用，我们将此Text变量声明为public的类型，为了可以在Inspector中对其进行直接的赋值。接下来要初始化CountText中所显示的文字，使用Text的text变量即可，在Start函数中进行初始化，然后再每一次碰撞到小立方体的时候再重新更新Text的内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">public Text countText;</span><br><span class="line">void Start()</span><br><span class="line">&#123;</span><br><span class="line">    rigidbodyPlayer = GetComponent&lt;Rigidbody&gt;();</span><br><span class="line">    count = 0;</span><br><span class="line">    countText.text = &quot;Count: &quot; + count.ToString();</span><br><span class="line">&#125;</span><br><span class="line">void OnTriggerEnter(Collider other)</span><br><span class="line">&#123;</span><br><span class="line">    if (other.gameObject.CompareTag(&quot;cube&quot;))</span><br><span class="line">    &#123;</span><br><span class="line">        other.gameObject.SetActive(false);</span><br><span class="line">        count++;</span><br><span class="line">        countText.text = &quot;Count: &quot; + count.ToString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>保存脚本回到Unity，将CountText拖动到Inspector中新产生的这个Text变量处来实例化它即可。</p>
<p><img src="18.jpg" style="zoom:50%;"></p>
<p>运行游戏，很好！</p>
<p>至此，游戏的主体部分已经完成。但按照最初的游戏设想，在完成游戏后会跳转到另一个界面提示游戏完成，玩家胜利，并附有重新开始游戏的按钮。让我们继续！</p>
<h3 id="最后的胜利"><a href="#最后的胜利" class="headerlink" title="最后的胜利"></a><strong>最后的胜利</strong></h3><hr>
<p>在Project的Scene文件下，右键，Create，Scene，并命名为Finish。这将创建一个新的场景。（你同时也可以将之前我们所进行的一系列操作的场景在Assets中找到并移动到Scene文件中方便管理）</p>
<p><img src="19.jpg" style="zoom:50%;"></p>
<p>然后我们需要将新场景添加到构建列表中。点击菜单File，Build Settings，添加我们的两个场景。</p>
<p><img src="22.jpg" style="zoom:50%;"></p>
<p>双击finish打开场景编辑。在Hierarchy窗口中，右键，UI，分别创建一个Text和Button。调整好颜色和位置。值得注意的是，按钮的文本内容位于Button的子对象中，需要对其的Inspector中属性进行调整以调整按钮的文本。</p>
<p><img src="20.jpg" style="zoom:50%;"></p>
<p>我们可以在Button的Inspector窗口的Button选项卡中更改按钮的外观细节。</p>
<p><img src="21.jpg" style="zoom:50%;"></p>
<p>接下来需要对原来的PlayController脚本进行小修改。在满足玩家将所有立方体都撞击的条件后（即分数point等于满分，比如这里因为共设置了8个立方体，每个立方体分数均为1分，所以总分为8分），跳转到我们新建的用于显示游戏胜利信息的新场景。跳转场景需要我们引入新的命名空间</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">using UnityEngine.SceneManagement;</span><br></pre></td></tr></table></figure>
<p>然后我们需要修改OnTriggerEnter函数内容。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">void OnTriggerEnter(Collider other)</span><br><span class="line">    &#123;</span><br><span class="line">        if (other.gameObject.CompareTag(&quot;cube&quot;))</span><br><span class="line">        &#123;</span><br><span class="line">            other.gameObject.SetActive(false);</span><br><span class="line">            point++;</span><br><span class="line">            pointText.text = &quot;Count: &quot; + point.ToString();</span><br><span class="line">            Debug.Log(point);</span><br><span class="line">            if (point == 8)</span><br><span class="line">                SceneManager.LoadScene(&quot;Finish&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>试着运行一下游戏，到这里我们已经能完成游戏结束后从游戏场景跳转到Finish场景，接下来我们需要对Finish场景的按钮添加代码来跳转到游戏场景以实现重现开始</p>
<p>新建脚本PlayAgain，并添加给按钮，编辑此脚本。首先在我们需要在Start函数中添加一个按钮的监听器以监听按钮的点击事件，绑定一个自定义函数OnClick。然后添加自定义函数OnClick，在其中完成场景跳转功能。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">using UnityEngine;</span><br><span class="line">using UnityEngine.UI;</span><br><span class="line">using UnityEngine.SceneManagement;</span><br><span class="line">public class PlayAgain : MonoBehaviour</span><br><span class="line">&#123;</span><br><span class="line">    void Start()</span><br><span class="line">    &#123;</span><br><span class="line">        this.GetComponent&lt;Button&gt;().onClick.AddListener(OnClick);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    void OnClick()</span><br><span class="line">    &#123;</span><br><span class="line">        SceneManager.LoadScene(&quot;BallMove&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行游戏，完美！</p>
<h3 id="分享"><a href="#分享" class="headerlink" title="分享"></a><strong>分享</strong></h3><p>至此游戏的制作大功告成。如果你想把自己的游戏分享给你的朋友，可以选择打包生成</p>
<p>点击菜单File，Build Settings，确认所有需要的场景均被勾选。在下面选择目标平台及相关设置，点击Build按钮即可</p>
<p><img src="23.jpg" style="zoom:50%;"></p>
<p><strong>另附上游戏的完整工程文件，如果你中途遇到困难可供参考：</strong><a href="https://github.com/histevehu/blog/raw/master/2020/02/02/Unity-Create-Ball-Game/BallMoveGame.zip" target="_blank" rel="noopener">BallMoveGame.zip</a></p>
  </article>
  <aside class="table-content" id="site-toc">
  <div class="table-content-title">
    <i class="fa fa-arrow-right fa-lg" id="site-toc-hide-btn"></i>
    <span>目录</span>
  </div>
  <div class="table-content-main">
    <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#前言"><span class="toc-text">前言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Unity中的一些基本知识"><span class="toc-text">Unity中的一些基本知识</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#概念"><span class="toc-text">概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#界面"><span class="toc-text">界面</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#正式开始"><span class="toc-text">正式开始</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#添加-amp-设置游戏对象"><span class="toc-text">添加&amp;设置游戏对象</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#地面"><span class="toc-text">地面</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#球"><span class="toc-text">球</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#墙"><span class="toc-text">墙</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#立方体"><span class="toc-text">立方体</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#代码，魔法"><span class="toc-text">代码，魔法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#球的移动"><span class="toc-text">球的移动</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#摄像机的跟踪"><span class="toc-text">摄像机的跟踪</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#立方体的旋转"><span class="toc-text">立方体的旋转</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#碰撞"><span class="toc-text">碰撞</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#计数器"><span class="toc-text">计数器</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#最后的胜利"><span class="toc-text">最后的胜利</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分享"><span class="toc-text">分享</span></a></li></ol>
  </div>
</aside>
  
    <aside class="passage-copyright">
      <div>本文作者: 董沅鑫</div>
      
        <div>
          原文链接: 
          <a href="" target="_blank">https://histevehu.com/passages/Unity-Create-Ball-Game/</a>
        </div>
      
      <div>
        版权声明: 本博客所有文章除特别声明外, 均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议. 转载请注明出处!
      </div>
    </aside>
  
  
    <div class="passage-tags">
     
      <a href="/tags/教程/"><i class="fa fa-tags"></i>教程</a>
    
    </div>
  
</div>

    </main>
    
      
<div class="site-comment-contanier" data-plateform="leancloud">
  
    <p id="site-comment-info">
      <i class="fa fa-spinner fa-spin"></i> 评论加载中
    </p>
    <div id="site-comment"></div>
  
</div>
    
    <div class="site-footer-wrapper">
  <footer class="site-footer">
    
      
        <div class="site-footer-col">
          <h5 class="site-footer-title">博客推荐</h5>
          
            <span class="site-footer-item">
              <a href="https://godbmw.com/" target="_blank">GodBMW</a>
            </span>
          
            <span class="site-footer-item">
              <a href="http://ruanyifeng.com/" target="_blank">阮一峰的个人网站</a>
            </span>
          
        </div>
      
        <div class="site-footer-col">
          <h5 class="site-footer-title">系列教程</h5>
          
            <span class="site-footer-item">
              <a href="https://godbmw.com/categories/webpack4%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B/" target="_blank">webpack4系列教程</a>
            </span>
          
            <span class="site-footer-item">
              <a href="https://godbmw.com/design-patterns/" target="_blank">设计模式手册</a>
            </span>
          
        </div>
      
        <div class="site-footer-col">
          <h5 class="site-footer-title">抓到我</h5>
          
            <span class="site-footer-item">
              <a href="https://juejin.im/user/5b91fcf06fb9a05d3c7fd4a5" target="_blank">掘金</a>
            </span>
          
            <span class="site-footer-item">
              <a href="https://segmentfault.com/" target="_blank">思否</a>
            </span>
          
        </div>
      
    
    <div class="site-footer-info">
      <i class="fa fa-clock-o"></i> 本站已稳定运行<span id="site-time"></span>
    </div>
    
      <div class="site-footer-info">
        <i class="fa fa-paw"></i> 您是本站第 <span id="site-count"></span> 位访客
      </div>
    
    
      <div class="site-footer-info">
        <i class="fa fa-at"></i> Email: yuanxin.me@gmail.com
      </div>
    
    <div class="site-footer-info">
      <i class="fa fa-copyright"></i> 
      2019 <a href="https://github.com/dongyuanxin/theme-ad/" target="_blank">Theme-AD</a>.
      Created by <a href="https://godbmw.com/" target="_blank">GodBMW</a>.
      All rights reserved.
    </div>
  </footer>
</div>
    <div id="site-layer" style="display:none;">
  <div class="site-layer-content">
    <div class="site-layer-header">
      <span class="site-layer-header-title" id="site-layer-title"></span>
      <i class="fa fa-close" id="site-layer-close"></i>
    </div>
    <div class="site-layer-body" id="site-layer-container">
      <div class="site-layer-input" id="site-layer-search" style="display: none;">
        <div class="site-layer-input-choose">
          <a href="javascript:void(0);" title="Change Search Engine">Google</a>
        </div>
        <input type="text">
        <i class="fa fa-search"></i>
      </div>
      
        <div class="site-layer-reward" id="site-layer-reward" style="display: none;">
          
            <div>
              <img src="/images/wechat.png" alt="WeChat">
              
                <p>WeChat</p>
              
            </div>
          
            <div>
              <img src="/images/alipay.png" alt="AliPay">
              
                <p>AliPay</p>
              
            </div>
          
        </div>
      
      <div id="site-layer-welcome" style="display:none;"></div>
    </div>
  </div>
</div>
    

<div class="bottom-bar">
  <div class="bottom-bar-left">
    <a href="/passages/Unity-Playground-Practice/" data-enable="true">
      <i class="fa fa-arrow-left"></i>
    </a>
    <a href="/passages/OpenGL-PointandLine/" data-enable="true">
      <i class="fa fa-arrow-right"></i>
    </a>
  </div>
  <div class="bottom-bar-right">
    <a href="javascript:void(0);" data-enable="true" id="site-toc-show-btn">
      <i class="fa fa-bars"></i>
    </a>
    
      <a href="#site-comment" data-enable="true">
        <i class="fa fa-commenting"></i>
      </a>
    
    <a href="javascript:void(0);" id="site-toggle-share-btn">
      <i class="fa fa-share-alt"></i>
    </a>
    
      <a href="javascript:void(0);" id="site-reward">
        <i class="fa fa-thumbs-up"></i>
      </a>
    
    <a href="javascript:void(0);" id="back-top-btn">
      <i class="fa fa-chevron-up"></i>
    </a>
  </div>
</div>
    <div id="share-btn">
  
    <a id="share-btn-twitter" href="javascript:void(0);" target="_blank">
      <i class="fa fa-twitter"></i>
    </a>
  
  
    <a id="share-btn-facebook" href="javascript:void(0);" target="_blank">
      <i class="fa fa-facebook"></i>
    </a>
  
  
    <a id="share-btn-weibo" href="javascript:void(0);" target="_blank">
      <i class="fa fa-weibo"></i>
    </a>
  
  
    <a id="share-btn-qq" href="javascript:void(0);" target="_blank">
      <i class="fa fa-qq"></i>
    </a>
  
  
    <a id="share-btn-wechat" href="javascript:void(0);" target="_blank">
      <i class="fa fa-wechat"></i>
    </a>
  
</div>
    





    
  </body>
</html>